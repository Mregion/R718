<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Pompe √† Chaleur - R718</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root{
      --bgOverlay: rgba(2,6,23,.78);
      --card: rgba(255,255,255,.10);
      --line: rgba(255,255,255,.12);
      --text: #f8fafc;
      --muted:#cbd5e1;
      --muted2:#9ca3af;
      --accent:#38bdf8;
      --radius: 16px;
      --shadow: 0 20px 60px rgba(0,0,0,.40);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;

      /* ‚úÖ Background (mets background.png dans ASSETS/) */
      background:
        linear-gradient(135deg, rgba(2,6,23,.82), rgba(2,6,23,.62)),
        url("ASSETS/background.png");
      background-position: center, center;
      background-size: cover, cover;
      background-repeat: no-repeat, no-repeat;
      background-attachment: fixed, fixed;
    }

    .page{
      padding:20px;
      max-width:1100px;
      margin:auto;
    }

    /* Header with logo next to title */
    .topbar{
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px 14px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.08);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .logoWrap{
      width:48px;height:48px;border-radius:12px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logoWrap img{width:100%;height:100%;object-fit:contain}
    .topTitles{min-width:0}
    .titleRow{
      display:flex;
      align-items:baseline;
      gap:10px;
      flex-wrap:wrap;
    }
    h1{
      font-size:18px;
      margin:0;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:4px 0 0;
      font-size:12px;
      color:var(--muted);
    }
    .badge{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
    }

    /* Hero */
    .hero{
      margin-top:14px;
      background:rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:16px;
      border:1px solid var(--line);
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }
    .heroTitle{font-size:15px;margin:0 0 8px}
    .heroTxt{margin:0;font-size:13px;color:var(--muted);line-height:1.45}
    .obj{
      margin:10px 0 0;
      padding-left:18px;
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
    }
    .obj li{margin:4px 0}

    /* Home grid */
    .homeGrid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:14px;
      margin-top:14px
    }
    .homeCard{
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      transition: transform .12s ease, background .12s ease;
      min-height:120px;
    }
    .homeCard:hover{
      background:rgba(255,255,255,.14);
      transform: translateY(-1px);
    }
    .homeCardTop{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .icon{
      width:36px;height:36px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(56,189,248,.14);
      border:1px solid rgba(56,189,248,.18);
      flex:0 0 auto;
    }
    .homeCard h3{margin:0;font-size:14px}
    .homeCard p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}

    /* Sections */
    .back{
      margin:12px 0 14px;
      cursor:pointer;
      color:#7dd3fc;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      font-size:12px;
      margin:10px 0 6px;
      color:var(--muted);
    }
    .sectionIntro{
      margin:8px 0 14px;
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:14px;
    }
    .box{
      background:rgba(255,255,255,.08);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }
    .box h3{margin:0 0 8px;font-size:14px;color:#e2e8f0}

    /* ‚úÖ Clickable images */
    .media{
      width:100%;
      height:230px;
      object-fit:contain;
      background:rgba(0,0,0,.55);
      border-radius:10px;
      border:1px solid rgba(255,255,255,.10);
      cursor: zoom-in;
    }

    .txt{
      color:var(--muted);
      font-size:13px;
      margin-top:8px;
      line-height:1.45;
    }
    .desc{
      color:var(--muted2);
      font-size:12px;
      margin-top:6px;
      line-height:1.45;
    }

    model-viewer{
      width:100%;
      height:420px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      margin-top:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .hint3d{
      margin-top:8px;
      font-size:12px;
      color:var(--muted2);
      text-align:center;
    }

    /* ===========================
       ‚úÖ Lightbox (zoom viewer)
       =========================== */
    .lightbox{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.82);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:18px;
    }
    .lightbox.open{display:flex}

    .lightboxPanel{
      width:min(1100px, 96vw);
      height:min(760px, 88vh);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      box-shadow: 0 20px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .lightboxTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .lbTitle{
      font-size:12px;
      color: var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:60%;
    }
    .lbBtns{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .lbBtn{
      border:none;
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
      background: rgba(56,189,248,.18);
      border:1px solid rgba(56,189,248,.22);
      color: var(--text);
      font-weight:700;
      font-size:12px;
    }
    .lbBtn.secondary{
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      font-weight:600;
    }

    .lightboxBody{
      position:relative;
      flex:1;
      overflow:auto; /* ‚úÖ important for zoom */
      background: rgba(0,0,0,.35);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .lbImg{
      max-width:none; /* allow scaling beyond container */
      max-height:none;
      width:auto;
      height:auto;
      transform-origin: center center;
      will-change: transform;
      user-select:none;
      -webkit-user-drag:none;
      cursor: grab;
    }
    .lbImg:active{cursor: grabbing}

    @media (max-width:520px){
      .page{padding:14px}
      model-viewer{height:340px}
      .media{height:210px}
      h1{font-size:16px}
      .lbTitle{max-width:45%}
    }
  </style>
</head>

<body>
<div id="app"></div>

<!-- ‚úÖ Lightbox DOM -->
<div id="lightbox" class="lightbox" onclick="closeLightbox(event)">
  <div class="lightboxPanel" onclick="event.stopPropagation()">
    <div class="lightboxTop">
      <div id="lbTitle" class="lbTitle">Image</div>
      <div class="lbBtns">
        <button class="lbBtn secondary" onclick="resetZoom()">Reset</button>
        <button class="lbBtn" onclick="zoomBy(1.2)">+</button>
        <button class="lbBtn" onclick="zoomBy(1/1.2)">‚àí</button>
        <button class="lbBtn secondary" onclick="downloadCurrent()">T√©l√©charger</button>
        <button class="lbBtn secondary" onclick="closeLightbox()">Fermer ‚úï</button>
      </div>
    </div>
    <div id="lbBody" class="lightboxBody">
      <img id="lbImg" class="lbImg" alt="zoom">
    </div>
  </div>
</div>

<script>
  // Acc√®s direct : pas de login
  let state = "home";
  const LOGO_SRC = "ASSETS/logo.jfif";

  // Helpers
  const img = (name) => `ASSETS/${name}`;

  const slides = {
    visualisation: [
      { title: "Visualisation 2D", img: img("2D.png"), txt: "Sch√©ma 2D du banc et des sous-ensembles." },
      { title: "Visualisation 3D", img: img("3D.png"), txt: "Vue 3D pour l‚Äôimplantation et l‚Äôint√©gration." },
      { title: "Cycle thermodynamique", img: img("cycle-thermodynamique.png"), txt: "Cycle et points de fonctionnement." }
    ],
    turbo: [
      { title: "Architecture", img: img("turbo_exploded.png"), txt: "Vue √©clat√©e / architecture du turbo." },
      { title: "Turbo ‚Äì int√©rieur", img: img("turbo-int.png"), txt: "Vue interne / √©l√©ments principaux." }
    ],
    echangeur: [
      { title: "√âchangeur ‚Äì ailettes (fins)", img: img("echangeur-fins.png"), txt: "Nouveau mod√®le d‚Äô√©changeur √† chaleur." },
      { title: "Bo√Æte ‚Äì cuve", img: img("boite-cuve.png"), txt: "Bo√Æte/volume principal et int√©gration." },
      { title: "CFD ‚Äì pression & lignes de courant", img: img("cfd_pressure_streamlines.png"), txt: "R√©partition pression et √©coulement." },
      { title: "CFD ‚Äì temp√©rature", img: img("cfd_temperature.png"), txt: "Champs de temp√©rature et zones critiques." },
      { title: "CFD ‚Äì vitesse", img: img("cfd_velocity.png"), txt: "Jets, recirculations et gradients de vitesse." }
    ],
    debit: [
      { title: "Capteur ŒîP", img: img("capteur-p-diff.png"), txt: "Mesure ŒîP : capteurs pr√©cis + capteur diff√©rentiel (‚âà3% d‚Äôincertitude)." },
      { title: "CFD ‚Äì tuyau", img: img("cfd-tuyau.png"), txt: "CFD support pour le positionnement/lecture ŒîP." }
    ],
    carac_turbo: [
      { title: "Diaphragm (photo)", img: img("diaphragm_photo.png"), txt: "Pi√®ce de r√©glage interne / g√©n√©ration de pertes de charge." },
      { title: "Caract√©risation turbo", img: img("carac_turbo.png"), txt: "Points d‚Äôop√©ration via pertes de charge contr√¥l√©es." }
    ],
    vide: [
      {
        title: "Bo√Æte (√©tanch√©it√©)",
        img: img("boite.png"),
        txt: "Bo√Æte soud√©e sur mesure.",
        desc: "Couvercle avec un joint d‚Äô√©tanch√©it√© √©pais."
      },
      {
        title: "Bouteille de pompage",
        img: img("bouteille-pompage.png"),
        txt: "Bouteille pour le vide (micropompe int√©gr√©e).",
        desc: "Un c√¥t√© soud√©, l‚Äôautre c√¥t√© avec deux brides Fullvac haute qualit√©, passages √©tanches et raccords pour connectiques micropompe."
      },
      {
        title: "Micropompe",
        img: img("micropompe.png"),
        txt: "Micropompe pour le vide primaire.",
        desc: "D√©bit jusqu‚Äô√† 2800 mL/min ‚Ä¢ Pression max ~300 mbar ‚Ä¢ Puissance ~5 W."
      }
    ]
  };

  function renderHeader(){
    return `
      <div class="topbar">
        <div class="logoWrap"><img src="${LOGO_SRC}" alt="logo"></div>
        <div class="topTitles">
          <div class="titleRow">
            <h1>Pompe √† Chaleur ‚Äì R718</h1>
            <span class="badge">Prototype exp√©rimental</span>
          </div>
          <div class="subtitle">Banc exp√©rimental ‚Ä¢ Turbo ‚Ä¢ CFD ‚Ä¢ Instrumentation ‚Ä¢ Vide primaire</div>
        </div>
      </div>
    `;
  }

  function renderSlides(key){
    return `
      <div class="grid">
        ${slides[key].map(s => `
          <div class="box">
            <h3>${s.title}</h3>
            <img class="media" src="${s.img}" alt="${s.title}" data-full="${s.img}">
            <div class="txt">${s.txt || ""}</div>
            ${s.desc ? `<div class="desc">${s.desc}</div>` : ""}
          </div>
        `).join("")}
      </div>
    `;
  }

  function attachImageLightbox(){
    // bind click on any .media image (after each render)
    document.querySelectorAll("img.media").forEach(el=>{
      el.addEventListener("click", () => {
        openLightbox(el.getAttribute("data-full") || el.src, el.alt || "Image");
      });
    });
  }

  function render(){
    const app = document.getElementById("app");

    if(state === "home"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}

          <div class="hero">
            <div class="heroTitle">Pr√©sentation technique / contexte</div>
            <p class="heroTxt">
              Interface de d√©monstration du banc exp√©rimental R718 : turbocompresseur, CFD,
              instrumentation ŒîP, et technologies pour le vide primaire.
            </p>
            <ul class="obj">
              <li><b>Banc exp√©rimental R718</b></li>
              <li><b>Caract√©risation d‚Äôun turbocompresseur</b></li>
              <li><b>D√©bitm√®tre de vapeur d‚Äôeau √† faible pression</b></li>
              <li><b>Nouvelles technologies pour vide primaire</b></li>
              <li><b>Nouveau mod√®le d‚Äôun √©changeur √† chaleur</b></li>
            </ul>
          </div>

          <div class="homeGrid">
            <div class="homeCard" onclick="state='visualisation';render()">
              <div class="homeCardTop"><div class="icon">üó∫Ô∏è</div><h3>1) Visualisation 2D ‚Ä¢ 3D ‚Ä¢ Cycle</h3></div>
              <p>Sch√©mas 2D/3D + cycle thermodynamique.</p>
            </div>

            <div class="homeCard" onclick="state='turbo';render()">
              <div class="homeCardTop"><div class="icon">üåÄ</div><h3>2) Turbo</h3></div>
              <p>Mod√®le 3D + pr√©sentation (2 √©tages, 90 000 rpm, compatible R718).</p>
            </div>

            <div class="homeCard" onclick="state='echangeur';render()">
              <div class="homeCardTop"><div class="icon">üî•</div><h3>3) √âchangeur ‚Ä¢ Bo√Æte ‚Ä¢ CFD</h3></div>
              <p>√âchangeur √† ailettes, bo√Æte/cuve, et r√©sultats CFD.</p>
            </div>

            <div class="homeCard" onclick="state='debit';render()">
              <div class="homeCardTop"><div class="icon">üìè</div><h3>4) Mesure de d√©bit</h3></div>
              <p>Mesure via ŒîP dans un tuyau + capteurs pr√©cis + mod√®le 3D CFD.</p>
            </div>

            <div class="homeCard" onclick="state='carac_turbo';render()">
              <div class="homeCardTop"><div class="icon">‚öôÔ∏è</div><h3>5) Caract√©risation turbo</h3></div>
              <p>G√©n√©ration de pertes de charge ‚Üí points d‚Äôop√©ration.</p>
            </div>

            <div class="homeCard" onclick="state='vide';render()">
              <div class="homeCardTop"><div class="icon">üß™</div><h3>6) Vide Technos</h3></div>
              <p>Soudure TIG, √©tanch√©it√©, outils Fullvac, vide primaire.</p>
            </div>
          </div>
        </div>
      `;
      attachImageLightbox();
      return;
    }

    if(state === "visualisation"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}
          <div class="back" onclick="state='home';render()">‚Üê Retour</div>
          <h1>1) Visualisation 2D ‚Ä¢ 3D ‚Ä¢ Cycle</h1>
          <div class="pill">Sch√©mas & cycle</div>
          <div class="sectionIntro">
            Vue d‚Äôensemble du banc : repr√©sentation 2D/3D et cycle thermodynamique.
          </div>
          ${renderSlides("visualisation")}
        </div>
      `;
      attachImageLightbox();
      return;
    }

    if(state === "turbo"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}
          <div class="back" onclick="state='home';render()">‚Üê Retour</div>
          <h1>2) Turbo</h1>
          <div class="pill">Mod√®le 3D interactif</div>

          <div class="sectionIntro">
            <b>Pr√©sentation :</b> 2 √©tages ‚Ä¢ 90 000 rpm ‚Ä¢ Compatible avec le R718
          </div>

          <model-viewer
            src="turbo_web.glb"
            camera-controls
            auto-rotate
            auto-rotate-delay="0"
            rotation-per-second="20deg"
            environment-image="neutral">
          </model-viewer>
          <div class="hint3d">üñê Glisser pour tourner ‚Ä¢ Pincer pour zoomer</div>

          <h1 style="font-size:16px;margin-top:18px">Images</h1>
          ${renderSlides("turbo")}
        </div>
      `;
      attachImageLightbox();
      return;
    }

    if(state === "echangeur"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}
          <div class="back" onclick="state='home';render()">‚Üê Retour</div>
          <h1>3) √âchangeur √† chaleur ‚Ä¢ Bo√Æte ‚Ä¢ CFD</h1>
          <div class="pill">√âchangeur + r√©sultats CFD</div>

          <div class="sectionIntro">
            Nouveau mod√®le d‚Äô√©changeur √† chaleur, int√©gration dans la bo√Æte, et visualisations CFD (pression, vitesse, temp√©rature).
          </div>

          ${renderSlides("echangeur")}
        </div>
      `;
      attachImageLightbox();
      return;
    }

    if(state === "debit"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}
          <div class="back" onclick="state='home';render()">‚Üê Retour</div>
          <h1>4) Mesure de d√©bit</h1>
          <div class="pill">ŒîP dans le tuyau + instrumentation</div>

          <div class="sectionIntro">
            Mesure du d√©bit en mesurant <b>ŒîP</b> dans le tuyau, avec <b>deux capteurs de pression pr√©cis</b>
            et un <b>capteur de pression diff√©rentielle</b> (~<b>3%</b> d‚Äôincertitude).
          </div>

          <div class="pill">Mod√®le 3D CFD interactif</div>
          <model-viewer
            src="cpd.glb"
            camera-controls
            auto-rotate
            auto-rotate-delay="0"
            rotation-per-second="20deg"
            environment-image="neutral">
          </model-viewer>
          <div class="hint3d">üñê Glisser pour tourner ‚Ä¢ Pincer pour zoomer</div>

          <h1 style="font-size:16px;margin-top:18px">Images</h1>
          ${renderSlides("debit")}
        </div>
      `;
      attachImageLightbox();
      return;
    }

    if(state === "carac_turbo"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}
          <div class="back" onclick="state='home';render()">‚Üê Retour</div>
          <h1>5) Caract√©risation de turbo</h1>
          <div class="pill">Points d‚Äôop√©ration</div>

          <div class="sectionIntro">
            Caract√©risation en g√©n√©rant des <b>pertes de charge</b> afin d‚Äôobtenir diff√©rents <b>points d‚Äôop√©ration</b>.
          </div>

          ${renderSlides("carac_turbo")}
        </div>
      `;
      attachImageLightbox();
      return;
    }

    if(state === "vide"){
      app.innerHTML = `
        <div class="page">
          ${renderHeader()}
          <div class="back" onclick="state='home';render()">‚Üê Retour</div>
          <h1>6) Vide Technos</h1>
          <div class="pill">√âtanch√©it√© & vide primaire</div>

          <div class="sectionIntro">
            Pour cette manip, nous avons utilis√© des moyens plus rassurants pour l‚Äô√©tanch√©it√© :
            <b>soudure TIG</b> partout et des <b>outils pour le vide primaire</b>.
          </div>

          <h1 style="font-size:16px;margin-top:10px">Images & descriptions</h1>
          ${renderSlides("vide")}

          <h1 style="font-size:16px;margin-top:18px">Outils Fullvac (3D)</h1>
          <div class="pill">Mod√®le 3D interactif</div>
          <div class="sectionIntro">
            Utilisant des outils <b>Fullvac</b>, soud√© d‚Äôun c√¥t√© et ferm√© de l‚Äôautre,
            avec passages √©tanches soud√©s pour les connectiques (capteurs / ŒîP).
          </div>

          <model-viewer
            src="cpd.glb"
            camera-controls
            auto-rotate
            auto-rotate-delay="0"
            rotation-per-second="20deg"
            environment-image="neutral">
          </model-viewer>
          <div class="hint3d">üñê Glisser pour tourner ‚Ä¢ Pincer pour zoomer</div>
        </div>
      `;
      attachImageLightbox();
      return;
    }
  }

  // ===========================
  // ‚úÖ Lightbox + Zoom logic
  // ===========================
  const lightbox = document.getElementById("lightbox");
  const lbImg = document.getElementById("lbImg");
  const lbTitle = document.getElementById("lbTitle");
  const lbBody = document.getElementById("lbBody");

  let currentSrc = "";
  let scale = 1;

  // drag to pan
  let isDragging = false;
  let startX = 0, startY = 0;
  let scrollLeft = 0, scrollTop = 0;

  function openLightbox(src, title){
    currentSrc = src;
    scale = 1;
    lbImg.style.transform = `scale(${scale})`;
    lbImg.src = src;
    lbTitle.textContent = title || "Image";
    lightbox.classList.add("open");

    // reset scroll to center-ish
    requestAnimationFrame(() => {
      lbBody.scrollTop = (lbBody.scrollHeight - lbBody.clientHeight)/2;
      lbBody.scrollLeft = (lbBody.scrollWidth - lbBody.clientWidth)/2;
    });
  }

  function closeLightbox(e){
    // if called from backdrop click
    lightbox.classList.remove("open");
  }

  function zoomBy(factor){
    scale *= factor;
    scale = Math.max(0.4, Math.min(scale, 6));
    lbImg.style.transform = `scale(${scale})`;
  }

  function resetZoom(){
    scale = 1;
    lbImg.style.transform = `scale(${scale})`;
    lbBody.scrollTop = 0;
    lbBody.scrollLeft = 0;
  }

  function downloadCurrent(){
    if(!currentSrc) return;
    const a = document.createElement("a");
    a.href = currentSrc;
    a.download = (lbTitle.textContent || "image") + ".png";
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  // Mouse wheel zoom
  lbBody.addEventListener("wheel", (e)=>{
    if(!lightbox.classList.contains("open")) return;
    e.preventDefault();
    const factor = (e.deltaY < 0) ? 1.12 : (1/1.12);
    zoomBy(factor);
  }, { passive:false });

  // Drag to pan (desktop)
  lbBody.addEventListener("mousedown", (e)=>{
    if(!lightbox.classList.contains("open")) return;
    isDragging = true;
    startX = e.pageX;
    startY = e.pageY;
    scrollLeft = lbBody.scrollLeft;
    scrollTop = lbBody.scrollTop;
  });
  window.addEventListener("mouseup", ()=>{ isDragging = false; });
  lbBody.addEventListener("mousemove", (e)=>{
    if(!isDragging) return;
    e.preventDefault();
    const dx = e.pageX - startX;
    const dy = e.pageY - startY;
    lbBody.scrollLeft = scrollLeft - dx;
    lbBody.scrollTop = scrollTop - dy;
  });

  // ESC to close
  window.addEventListener("keydown", (e)=>{
    if(e.key === "Escape" && lightbox.classList.contains("open")){
      closeLightbox();
    }
  });

  render();
</script>
</body>
</html>
